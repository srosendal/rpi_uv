<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RPi Visual Test Strip Analyzer</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div id="app-container">
        <!-- Header -->
        <header>
            <h1>Test Strip Analyzer</h1>
            <div id="header-controls">
                <button id="normal-mode-btn" class="header-btn active">Capture Mode</button>
                <button id="settings-mode-btn" class="header-btn">Settings Mode</button>
                <button id="exit-btn" class="header-btn exit-btn">Exit</button>
            </div>
        </header>

        <!-- Main Content -->
        <div id="main-content">
            <!-- Top Section: Two Columns -->
            <div id="top-section">
                <!-- Live View Section -->
                <div id="camera-section">
                <div id="camera-container">
                    <img id="mjpeg-stream" width="406" height="304" style="display: block; position: absolute; top: 0; left: 0;">
                    <canvas id="camera-canvas" width="406" height="304" style="display: none;"></canvas>
                    <svg id="roi-overlay" width="406" height="304">
                        <!-- ROI rectangles will be drawn here -->
                        <rect id="roi-1" class="roi-rect" x="117" y="89" width="141" height="19" />
                        <rect id="roi-2" class="roi-rect" x="117" y="136" width="141" height="19" />
                        <rect id="roi-3" class="roi-rect" x="117" y="183" width="141" height="19" />
                        <rect id="roi-4" class="roi-rect" x="117" y="230" width="141" height="19" />
                        <!-- ROI labels -->
                        <text id="label-1" class="roi-label" x="103" y="101">1</text>
                        <text id="label-2" class="roi-label" x="103" y="148">2</text>
                        <text id="label-3" class="roi-label" x="103" y="195">3</text>
                        <text id="label-4" class="roi-label" x="103" y="242">4</text>
                    </svg>
                </div>
                <div id="camera-info">
                    <span>Streaming: 406x304</span>
                    <span id="fps-counter">Streaming...</span>
                </div>
            </div>

                <!-- Control Panel -->
                <div id="control-panel">
                    <!-- Normal Mode Controls -->
                    <div id="normal-controls">
                        <div id="results-section">
                        <div id="results-grid">
                            <div class="result-item">
                                <span class="result-label">Stripe 1:</span>
                                <span id="result-1" class="result-value">---</span>
                            </div>
                            <div class="result-item">
                                <span class="result-label">Stripe 2:</span>
                                <span id="result-2" class="result-value">---</span>
                            </div>
                            <div class="result-item">
                                <span class="result-label">Stripe 3:</span>
                                <span id="result-3" class="result-value">---</span>
                            </div>
                            <div class="result-item">
                                <span class="result-label">Stripe 4:</span>
                                <span id="result-4" class="result-value">---</span>
                            </div>
                        </div>
                        <div id="status-message"></div>
                        </div>
                    </div>

                    <!-- Settings Mode Controls -->
                    <div id="settings-controls" style="display: none;">
                    <div class="settings-group">
                        <div class="roi-selector">
                            <button class="roi-select-btn active" data-roi="1">ROI 1</button>
                            <button class="roi-select-btn" data-roi="2">ROI 2</button>
                            <button class="roi-select-btn" data-roi="3">ROI 3</button>
                            <button class="roi-select-btn" data-roi="4">ROI 4</button>
                        </div>
                    </div>

                    <div class="settings-group">
                        <div class="mode-selector">
                            <button class="mode-btn active" data-mode="move">Move</button>
                            <button class="mode-btn" data-mode="increase">Increase</button>
                            <button class="mode-btn" data-mode="decrease">Decrease</button>
                        </div>
                    </div>

                    <div class="settings-group">
                        <div class="direction-controls">
                            <button class="dir-btn" data-dir="up">▲</button>
                            <button class="dir-btn" data-dir="down">▼</button>
                            <button class="dir-btn" data-dir="left">◄</button>
                            <button class="dir-btn" data-dir="right">►</button>
                        </div>
                        <div class="movement-info">
                            <small>Step: <span id="step-size">5</span>px</small>
                        </div>
                    </div>

                    <div class="settings-group">
                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px;">
                            <div>
                                <label for="num-photos">Photos (1-5):</label>
                                <input type="number" id="num-photos" min="1" max="5" value="2" style="width: 100%;">
                            </div>
                            <div>
                                <label for="startup-delay">Startup (0.5-5s):</label>
                                <input type="number" id="startup-delay" min="0.5" max="5" step="0.5" value="1.0" style="width: 100%;">
                            </div>
                            <div>
                                <label for="capture-delay">Delay (0.5-5s):</label>
                                <input type="number" id="capture-delay" min="0.5" max="5" step="0.5" value="1.0" style="width: 100%;">
                            </div>
                        </div>
                    </div>

                    <div class="settings-group">
                        <label for="save-location">Save Location:</label>
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <select id="save-location-preset" style="flex: 0 0 auto; padding: 8px;">
                                <option value="">Quick Select...</option>
                                <option value="photos">photos</option>
                                <option value="/home/pi/photos">~/photos</option>
                                <option value="/media/usb">USB Drive</option>
                                <option value="custom">Custom Path</option>
                            </select>
                            <input type="text" id="save-location-display" value="photos" placeholder="Enter custom path" style="flex: 1;">
                        </div>
                        <small style="color: #666; font-size: 0.85em;">Select preset or enter custom path (timestamped folders will be created here)</small>
                    </div>

                    <div class="settings-group">
                        <label for="pwm-duty-cycle">PWM Duty Cycle (0-100%):</label>
                        <input type="range" id="pwm-duty-cycle" min="0" max="100" value="60">
                        <span id="pwm-duty-value">60%</span>
                    </div>

                    <div class="settings-group">
                        <label for="camera-command">Camera Command:</label>
                        <input type="text" id="camera-command" value="rpicam-still" placeholder="e.g., rpicam-still --shutter 5000">
                    </div>

                    </div>
                </div>
            </div>

            <!-- Bottom Action Row -->
            <div id="action-row">
                <!-- Normal Mode Actions -->
                <div id="normal-actions">
                    <button id="capture-btn" class="primary-btn">
                        Capture & Analyze
                    </button>
                </div>
                
                <!-- Settings Mode Actions -->
                <div id="settings-actions" style="display: none;">
                    <button id="save-config-btn" class="action-btn">Save Config</button>
                    <button id="reset-config-btn" class="action-btn secondary">Reset</button>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer>
            <p>Meka Innovation Pte Ltd</p>
        </footer>
    </div>

    <!-- Scripts -->
    <script src="js/image-analyzer.js"></script>
    <script src="js/roi-manager.js"></script>
    <script src="js/app.js"></script>
</body>
</html>
